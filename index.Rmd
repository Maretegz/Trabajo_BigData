---
title: "Historia económica de Sudáfrica"
subtitle: "Mario García Zamora(magarza2@alumni.uv.es)" #- pongo tú nombre ahí para q aparezca más grande q el de la UV
author: "Universitat de València"
date: "Diciembre de 2021 (actualizado el `r format(Sys.time(), '%d-%m-%Y')`)"
output:
  html_document: 
    theme: simplex
    highlight: tango
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    df_print: kable
    code_download: yes
    code_folding: "hide"
editor_options: 
  chunk_output_type: console
  theme: tactile
---

```{r packages-setup, include = FALSE}
library(tidyverse)
library(klippy)  
remotes::install_github("rlesur/klippy")
library(knitr)
library(tibble)
library(ggthemes)
library(ggplot2)
library(dplyr)
library(patchwork)
library(ggrepel)
library(sf)
library(ggspatial)
library(rnaturalearth)
library(rnaturalearthdata)
library(pjpv2020.01)
library(plotly)
library(gganimate)
library (gifski)
library(gt)
library(kableExtra)
library(DT)
library(leaflet) 
library(leafem) 
library(DT)
library(tmap)
library(leaflet)
library(vembedr)
library(hrbrthemes)
library(readxl)
library(viridis)
library(forcats)
library(lessR)
require("jpeg")
require("grid")
```

```{r chunk-setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, 
                      #results = "hold",
                      cache = FALSE, cache.path = "/caches/", comment = "#>",
                      #fig.width = 7, #fig.height= 7,   
                      #out.width = 7, out.height = 7,
                      collapse = TRUE,  fig.show = "hold",
                      fig.asp = 0.628, out.width = "75%", fig.align = "center")
knitr::opts_chunk$set(dev = "png", dev.args = list(type = "cairo-png"))
```


```{r options-setup, include = FALSE}
options(scipen = 999) #- para quitar la notación científica
options("yaml.eval.expr" = TRUE) 
```


```{r klippy, echo = FALSE}
klippy::klippy(position = c("top", "right")) #- remotes::install_github("rlesur/klippy")
```
<hr class="linea-black">

<!-- El párrafo de abajo has de dejarlo casi igual, solo HAS de SUSTITUIR "perezp44" por tu usuario de Github-->
Trabajo elaborado para la asignatura "Programación y manejo de datos en la era del Big Data" de la Universitat de València durante el curso 2021-2022. El repo del trabajo está [aquí](https://github.com/maretegz/trabajo_BigData){target="_blank"}. 

<!-- El párrafo de abajo has de dejarlo exactamente igual, NO HAS DE CAMBIAR NADA-->

La página web de la asignatura y los trabajos de mis compañeros pueden verse [aquí](https://perezp44.github.io/intro-ds-21-22-web/07-trabajos.html){target="_blank"}.


<hr class="linea-red">

# <FONT COLOR="#2b308f"> **1. Introducción** </FONT>
<FONT COLOR="#8f2b30">
Sudáfrica es uno de los países más desarrollados de todo el continente africano. Su PIB representa el 25% de todo el continente y su evolución desde el siglo pasado ha sido notable, pero ¿a qué se debe este crecimiento? ¿Podemos poner a Sudáfrica a la altura de países desarrollados o en desarrollo? ¿Está más cerca Sudáfrica de China o de los países de su entorno?

Todas estas preguntas son las que espero dar respuesta en este análisis, para ello nos centraremos en diferentes variables que yo considero esenciales para entender el crecimiento de un país. Estas serán el PIB per cápita, donde centraré la mayor parte de los esfuerzos; también analizaré la esperanza de vida, los sectores de crecimiento, la desigualdad y la pobreza, así como el comercio exterior. 
</FONT>




```{r, eval = TRUE}


```



# <FONT COLOR="#2b308f"> **2. Datos** </FONT>
<FONT COLOR="#8f2b30">
Encontrar los datos y arreglarlos no ha sido una tarea demasiado complicada, con únicamente 2 fuentes de datos extraídas directamente del Banco Mundial y del Madison Project database tenemos suficiente para analizar lo que necesitamos. Además, desde el paquete tmap podemos utilizar los datos de World, para ayudarnos en la separación por continentes, regiones y coordenadas.

No tengo los links de donde extraje los datos ya que los saqué hace tiempo y no los apunté, de todas maneras están sacados directamente de la web sin ninguna modificación por lo que el link se puede encontrar. El problema es que, por ejemplo, en los datos del Banco Mundial, para sacar exactamente el excel que yo he utilizado es necesario filtrar alguna serie de cosas en la propia web.
</FONT>


```{r, eval = TRUE}
mpd2020 <- read_excel("datos/mpd2020.xlsx", sheet = "Full data")

data(World) 
world<- World %>%
  rename(countrycode = iso_a3) %>%
  select(countrycode, continent)

banco_mundial <- read_excel("./datos/banco_mundial.xlsx")
banco_mundial[, c(5:65)] <- sapply(banco_mundial[, c(5:65)], as.numeric)
banco_mundial <-banco_mundial%>%
  pivot_longer(cols = c(5:65), values_to = "series", names_to = "year" )


banco_mundial_1 <- banco_mundial %>% select(year, series, 'Series Name', 'Country Name', `Country Code`) %>%
  pivot_wider(names_from = 'Series Name', values_from = series, values_fn = sum)
```


## <FONT COLOR="#12522f"> 2.1 Procesando los datos </FONT>
<FONT COLOR="#8f2b30">
Lo más difícil en la extracción de datos se da cuando tratamos de importar el excel del Banco Mundial, puesto que los datos salen al revés de como nos gustaría manejarlos, pero con un pivot longer podemos trabajar mucho mejor. El problema es que así tampoco se queda como queremos, antes estaban las fechas en las columnas, es decir, cada columna era una fecha, ahora eso está bien pero las variables no son una columna cada una. Por lo tanto hay que hacer un pivot wider más pero hay que aladir la función values_fn = sum porque sino no coloca los datos correctamente.

Sin duda está fue la parte más complicada de arreglar, aunque de nuevo teníamos un problema que no pude solucionar hasta más tarde, cuando ya había algún gráfico hecho. Las fechas no son númericas puesto que vienen con el formato "2108[YR2018]" por lo que a la hora de hacer gráficos es un problema grande. Para ello tuvimos que crear la variable date y añadirla manualmente al df, pero lo iré haciendo en cada gráfico porque, como digo, es un problema que solucioné tarde.

</FONT>

# <FONT COLOR="#2b308f"> **3. Trabajos en los que te has basado** </FONT>
<FONT COLOR="#8f2b30">
No me he basado en ningún trabajo en particular, he buscado información en infinidad de sitios y, en cuanto al contenido, me he centrado principalmente en las indicaciones de mi asignatura "crecimiento y desarrollo económico en la historia", donde analizamos la evolución de los diferentes territorios del mundo a lo largo de la historia y podemos hacernos una idea del por qué de su evolución según los principales factores.

</FONT>

# <FONT COLOR="#2b308f"> **4. PIB per cápita** </FONT>



## <FONT COLOR="#12522f"> 4.1 Evolución </FONT> {.tabset .tabset-pills}



<FONT COLOR="#8f2b30">
Aquí podemos apreciar como a partir de la década de los 40 el crecimiento sudafricano comienza a ser notable, es cuando las élites blancas del país comienzan a ser más autosuficientes y a controlar cada vez más riqueza gracias al crecimiento de sus minas y sus empresas. En estos años llegó la independencia de Reino Unido, el apartheid, el boicot internacional y, en la década de los 90, la democracia, donde vemos el mayor crecimiento.

En el gráfico podemos apreciar, además de la evolución del PPC, los años durante los cuales Sudáfrica fue una colonia, primero de Países Bajos y más tarde de Reino Unido.


</FONT>


### <FONT COLOR="#8f2b30"> **En dólares de 2010** </FONT>


```{r, eval = TRUE, echo = TRUE}
mpd2020_1 <- mpd2020 %>% 
  filter(countrycode == "ZAF")
sudaf <- readJPEG("./datos/sudaf.jpg")
sudaf <- rasterGrob(sudaf, width=unit(1,"npc"), height=unit(1,"npc"), interpolate=TRUE) 
bri <- readJPEG("./datos/uk.jpg")
bri <- rasterGrob(bri, width=unit(1,"npc"), height=unit(1,"npc"), interpolate=TRUE) 
ned <- readJPEG("./datos/paisesbajos.jpg")
ned <- rasterGrob(ned, width=unit(1,"npc"), height=unit(1,"npc"), interpolate=TRUE) 
g1 <-   ggplot(mpd2020_1, aes(x=year, y=gdppc)) +
  annotation_custom(ned, xmin = -Inf, xmax = 1800, ymin = 0, ymax = 13000)+
  annotation_custom(bri, xmin = 1800, xmax = 1950, ymin = 0, ymax = 13000)+
  annotation_custom(sudaf, xmin = 1950, xmax = +Inf, ymin = 0, ymax = 13000)+
  geom_line( color="grey") +
  geom_point(shape=21, color="black", fill="#69b3a2", size=1) +
  theme_ipsum() +
  ggtitle("PIB PER CÁPITA SUDÁFRICA") +
  scale_x_continuous("Año", breaks = seq(1700,2020,20) ,limits = c(1700, 2020)) + 
  scale_y_continuous("PIB per cáptita", labels = scales::dollar) +
  labs(caption = "Elaboración propia con datos del Madison Project Database") +
  theme(axis.text.x = element_text(angle=45)) 
g1 
```



### <FONT COLOR="#8f2b30"> **En logaritmos** </FONT>


<FONT COLOR="#8f2b30">
Si lo analizamos en logaritmos apreciamos como los años de colonización no fueron precisamente buenos para los sudafricanos, que cuando lograron la independencia fue cuando experimentaron el mayor crecimiento.
</FONT>

```{r, eval = TRUE, echo = TRUE}
glog <-  ggplot(mpd2020_1, aes(x=year, y=gdppc)) +
  scale_y_log10("Logaritmo PPC", NULL)+
  annotation_custom(ned, xmin = -Inf, xmax = 1800, ymin = 2.9, ymax = 4.2)+
  annotation_custom(bri, xmin = 1800, xmax = 1950, ymin = 2.9, ymax = 4.2)+
  annotation_custom(sudaf, xmin = 1950, xmax = +Inf, ymin = 2.9, ymax = 4.2)+ 
  geom_line( color="grey") +
  geom_point(shape=21, color="black", fill="#69b3a2", size=1) +
  theme_ipsum() +
  ggtitle("PIB PER CÁPITA SUDÁFRICA") +
  scale_x_continuous("Año", breaks = seq(1700,2020,20) ,limits = c(1700, 2020))  +
  labs(caption = "Elaboración propia con datos del Madison Project Database") +
  theme(axis.text.x = element_text(angle=45)) 
glog
```



<br>



## <FONT COLOR="#12522f"> 4.2 Comparación con el resto de África </FONT>
<FONT COLOR="#8f2b30">
Desde 1960 el crecimiento sudafricano fue notable, ¿pero podemos distinguir una gran evolución si lo comparamos con el resto de países del entorno? 


### <FONT COLOR="#8f2b30"> 4.2.1 Comparación en mapas </FONT>{.tabset .tabset-pills}



<FONT COLOR="#8f2b30">
Con estos dos mapas (uno hasta el año 1995 y otro posterior) apreciamos como realmente Sudáfrica ya era uno de los países africanos más ricos en 1960 y fue algo que se mantuvo durante todo el periodo, pese al fuerte crecimiento de otros países.
</FONT>



#### <FONT COLOR="#8f2b30"> **1960 - 1995** </FONT>





```{r, eval = TRUE, echo = TRUE}
df1 <- inner_join(mpd2020, world) %>%
  filter(continent == "Africa")
df2 <- df1 %>% filter(year >= 1960) %>% filter(year <= 1995)

mapa <- ggplot() +
  geom_sf(data = df2, aes(geometry = geometry, fill = gdppc)) +
  theme_void()   +
  scale_fill_continuous(breaks = seq(1000, 15000, 1000),low="#baf0ff",high="#022129") + 
   transition_manual(year) +
  labs(title = "PIB per cápita en África año {current_frame}",
       caption = "Fuente: Elaboración propia con datos del Madison Project Database",
       fill = "En dólares") +
  guides(fill = guide_colorbar(barheight = unit(10, "cm")))
mapa
```
<FONT COLOR="#8f2b30">
PD: Nótese que sudáfrica es el país situado más al sur de África



#### <FONT COLOR="#8f2b30"> **1995 - 2018** </FONT>

```{r, eval = TRUE, echo = TRUE}
df3 <- df1 %>% filter(year >=1996)
mapa96 <- ggplot() +
  geom_sf(data = df3, aes(geometry = geometry, fill = gdppc)) +
  theme_void() +
  scale_fill_continuous(breaks = seq(1000, 50000, 5000),low="#baf0ff",high="#022129") + 
  transition_manual(year) +
  labs(title = "PIB per cápita en África año {current_frame}",
       caption = "Fuente: Elaboración propia con datos del Madison Project Database",
       fill = "En dólares") +
  guides(fill = guide_colorbar(barheight = unit(10, "cm")))
mapa96
```



<br>



### <FONT COLOR="#8f2b30"> 4.2.2 Comparación en gráfico y en tabla </FONT>{.tabset .tabset-pills}

<FONT COLOR="#8f2b30">
Aquí podemos apreciar lo mismo que anteriormente. Nótese el elevado crecimiento de países como Gabón, Guinea Ecuatorial o Lybia, aunque el de Sudáfrica no podemos decir que esté mal.
</FONT>



#### <FONT COLOR="#8f2b30"> **Gráfico** </FONT>
```{r, eval = TRUE, echo = TRUE}
df4<- df1 %>% filter(year >= 1950)
df5 <- df4 %>% mutate(paises = country)
df6 <- df5 %>%
  filter(country == 'South Africa')
g2 <- ggplot(df6, aes(x=year, y=gdppc)) +
  geom_line(data=df5 %>% dplyr::select(-country), aes(group=paises), color="grey", size=0.5, alpha=1) +
  geom_line( aes(fill = country),color = "#2d7d3e",  size=1.2 )+
  scale_color_viridis_d() +
  theme_ipsum() +
  theme(
    legend.position = "left",
    plot.title = element_text(size=14),
    panel.grid = element_blank()) +
  labs(title = "PIB per cápita países africanos", caption = "Elaboración propia con datos del Madison Project Database") + 
  ylab(NULL) + xlab(NULL) +
  scale_y_continuous(breaks = seq(0, 25000, 5000), limits = c(0, 25000))
ggplotly(g2)  
```

#### <FONT COLOR="#8f2b30"> **Tabla** </FONT>
```{r, eval = TRUE, echo = TRUE}
DT::datatable(df5)
```



<br>



### <FONT COLOR="#8f2b30"> 4.2.3 Todo mucho más compacto </FONT>


<FONT COLOR="#8f2b30">
En este gráfico podemos apreciar la evolución del PPC sudafricano en comparación con la media del África subsahariana (zona a la que pertenece Sudáfrica), la media general de todo el continente y el país que más PPC ha tenido cada año (excluyendo Guinea Ecuatorial Y Lybia con índices muy elevados). 

Es interesante ver como siempre ha sido mucho más rica que la media del continente y más aún que los países de su alrededor. además, durante los años 50 y 60 era el país más rico de África.
</FONT>
```{r, eval = TRUE, echo = TRUE}
dfsubsaharian <- df5 %>% filter(country %in% c("Angola", "Sudáfrica", "Burundi", "Cabo Verde", "República Centroafricana", "República Democrática del Congo", "República del Congo", "Côte d'Ivoire", "Eritrea", "Etiopía", "Guinea", "Kenya", "Lesotho", "Liberia", "Madagascar", "Mauritania", "Mozambique", "Sierra Leona", "Somalia", "Sudán", "Botswana", "Tanzania", "Uganda", "Zimbabwe")) %>% 
  group_by(year) %>% summarise(media_africa_subsahariana = mean(gdppc))
dfresto <- df5 %>% filter(!country %in% c("Angola", "Sudáfrica", "Burundi", "Cabo Verde", "República Centroafricana", "República Democrática del Congo", "República del Congo", "Côte d'Ivoire", "Eritrea", "Etiopía", "Guinea", "Kenya", "Lesotho", "Liberia", "Madagascar", "Mauritania", "Mozambique", "Sierra Leona", "Somalia", "Sudán", "Botswana", "Tanzania", "Uganda", "Zimbabwe")) %>%
  group_by(year) %>% summarise(media_resto_africa = mean(gdppc))
dfafrica <- df5 %>% group_by(year) %>% summarise(media_todo_africa = mean(gdppc))
dfmax <- df5 %>% filter(!country %in% c('Equatorial Guinea', 'Libya'))%>%
  group_by(year) %>% slice_max(gdppc, n=1)
#tenemos que excluir Guinea Ecuatorial y Libia porque tiene valores demasiado altos y no se vería bien
g3 <- ggplot() +
  geom_line(data = df6, aes(year, gdppc), color="#2d7d3e", size=1.2 ) +
  geom_line(data = dfsubsaharian, aes(year, media_africa_subsahariana), color="grey", size=0.5 ) +
  geom_line(data = dfafrica, aes(year, media_todo_africa), color="grey", size=0.5 ) +
  geom_line(data = dfresto, aes(year, media_resto_africa), color="grey", size=0.5 ) +
  geom_line(data = dfmax, aes(year, gdppc), color="grey", size=0.5 ) +
  geom_point(data = dfmax, aes(year, gdppc, text = country), colour = "grey", size =  0.5,alpha = 1/2) +
  theme_ipsum() +
  labs(title = "Comparación PIB per cápita", 
       subtitle =  "Elaboración propia con datos del Madison Project Database") + 
  ylab("PIB per cápita") + xlab("Año") +
  scale_y_continuous(breaks = seq(0, 18000, 2000), limits = c(0, 20000), labels = scales::dollar) +
  scale_x_continuous(breaks = seq(1950, 2020, 10)) +
  annotate(geom = "text", x= 2013, y = 18700,label = "Mayor PIB per cápita de África",size = 2.5,  color = "black") + 
  annotate(geom = "text", x= 2018, y = 13000,label = "Sudáfrica",size = 2.5,  color = "#2d7d3e") + 
  annotate(geom = "text", x= 2010, y = 7000,label = "Resto de África (no subsahariana)",size = 2.5,  color = "black") + 
  annotate(geom = "text", x= 2016, y = 5400,label = "Continente africano",size = 2.5,  color = "black") + 
  annotate(geom = "text", x= 2016, y = 4100,label = "África Subsahariana",size = 2.5,  color = "black") 
ggplotly(g3)
```



<br>



## <FONT COLOR="#12522f"> 4.3 Comparación con los BRICS </FONT>{.tabset .tabset-pills}



<FONT COLOR="#8f2b30">
Desde 2011, Sudáfrica fue nombrada integrante de los BRICS como países de alto crecimiento económico. En este selecto grupo se encontraba también Brasil, Rusia, China, India. He añadido a España también en la comparación para hacernos una idea más real. 
</FONT>



### <FONT COLOR="#8f2b30"> 1700 - 1900 </FONT>


<FONT COLOR="#8f2b30">
Podemos apreciar como en el siglo XIX Sudáfrica era un país mucho más rico que el resto y cómo los 2 siglos de colonización empobrecieron al país. Aún así, si no contamos a España (país donde el crecimiento moderno llegó antes), sí que vemos que Sudáfrica era el más rico de todos, ya que estos tampoco crecen en estos siglos. Revolución muy tardía para los BRICS
</FONT>


```{r, eval = TRUE, echo = TRUE}
df9 <- mpd2020 %>% filter(country %in% c("Spain", "Brazil", "India", "China", "South Africa")) %>% filter(year %in% c("1700", "1850", "1900")) %>% drop_na(gdppc)
dfspain <- mpd2020 %>% filter(country == "Spain") %>% filter(year == 1705) %>% 
  rename(date = year) %>%
  mutate(year = date - 5) %>% select(-date)
df9 <- rbind(df9, dfspain)
g4 <- ggplot(df9, aes(country, gdppc)) + 
  geom_bar(stat="identity") + 
  theme_classic() + 
  geom_text(aes(y = gdppc, label = gdppc), 
            position = position_dodge(width = 0.9), size=3,
            vjust=-0.1, hjust=0.5 ,col="black", fontface = "bold") +
  labs(title = "Comparación con los BRICS + España",
       subtitle = "(PIB per cápita)",
       x = "Países",
       y = "PIB per cápita", 
       caption = "Elaboración propia con datos del Madison Project Database") + 
  theme(plot.title = element_text(size = 20, face = "bold", 
                                  hjust = 0.5), 
        plot.subtitle = element_text(size = 20, hjust = 0.5)) +
  facet_wrap(vars(year), nrow = 1) +
  scale_x_discrete(labels=c("Brasil","China","India",
                            "Sudáfrica", "España")) +
  scale_y_continuous(limits = c(0, 3000)) + theme(axis.text.x = element_text(angle=90))
g4
```


<FONT COLOR="#8f2b30">
De algunos países no había datos en algunas fechas, he cogido el dato más cercano. Salvo de Brasil En 1700 donde no tenía nada ni cerca.
</FONT>



### <FONT COLOR="#8f2b30"> Todo mucho más compacto </FONT>


<FONT COLOR="#8f2b30">
A partir de 1950, los BRICS comenzaron a crecer, aunque el crecimiento más alto y por el que adquirieron esta etiqueta fue a partir de los 90. Podemos apreciar la fuerte ventaja que obtiene España en 1995, este crecimiento moderno llegaría más tarde para los BRICS.
</FONT>


```{r, eval = TRUE, echo = TRUE}
df10 <- mpd2020 %>% filter(country %in% c("Spain", "Brazil", "India", "China", "Russian Federation", "South Africa")) %>% filter(year %in% c("1950", "1995", "2018")) %>% drop_na(gdppc)
dfrusia <- mpd2020 %>% filter(country == "Russian Federation") %>% filter(year == 1960) %>% 
  rename(date = year) %>%
  mutate(year = date - 10) %>% select(-date)
df10 <- rbind(df10, dfrusia)
g5 <- ggplot(df10, aes(country, gdppc)) + 
    geom_bar(stat="identity") + 
  theme_classic() + 
  geom_text(aes(y = gdppc, label = gdppc), 
            position = position_dodge(width = 0.9), size=3,
            vjust=-0.1, hjust=0.5 ,col="black", fontface = "bold") +
  labs(title = "Comparación con los BRICS + España",
       subtitle = "(PIB per cápita)",
       x = "Países",
       y = "PIB per cápita", 
       caption = "Elaboración propia con datos del Madison Project Database") + 
  theme(plot.title = element_text(size = 15, face = "bold", 
                                  hjust = 0.5), 
        plot.subtitle = element_text(size = 10, hjust = 0.5)) +
  facet_wrap(vars(year), nrow = 1) +
  scale_x_discrete(labels=c("Brasil","China","India",
                            "Rusia", "Sudáfrica", "España")) +
  scale_y_continuous(limits = c(0, 32000)) + theme(axis.text.x = element_text(angle=90))
g5
```



<br>



# <FONT COLOR="#2b308f"> **5. Esperanza de vida** </FONT>


## <FONT COLOR="#12522f"> 5.1 Comparación con el mundo </FONT>


<FONT COLOR="#8f2b30">
Si comparamos uno de los indicadores más importantes, la esperanza de vida, vemos como la evolución en Sudáfrica es realmente sorprendente. Después del continuo crecimiento durante los años del apartheid, con la llegada de la democracia la esperanza de vida cae considerablemente, aunque a partir de 2005 vuelve a recuperarse. 

Relativamente Sudáfrica ha empeorado bastante su esperanza de vida, de estar muy por encima de la media africana y muy cerca del resto del mundo (relativamente al menos) a situarse muy cerca de su propio continente. 
</FONT>
```{r, eval = TRUE, echo = TRUE}
esp <- banco_mundial_1 %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp <- janitor::clean_names(esp)
date <- c(1960:2020)
esp <- cbind(esp, date)
esp_1 <- esp %>% filter(country_name == "Sudáfrica")

africa <- world %>% filter(continent == "Africa") %>% select(countrycode)
africa <- banco_mundial_1 %>% filter(`Country Code` %in% africa$countrycode)
asia <- world %>% filter(continent == "Asia") %>% select(countrycode)
asia <- banco_mundial_1 %>% filter(`Country Code` %in% asia$countrycode)
europa <- world %>% filter(continent == "Europe") %>% select(countrycode)
europa <- banco_mundial_1 %>% filter(`Country Code` %in% europa$countrycode)
america <- world %>% filter(continent %in% c("North America", "South America")) %>% select(countrycode)
america <- banco_mundial_1 %>% filter(`Country Code` %in% america$countrycode)
oceania <- world %>% filter(continent == "Oceania") %>% select(countrycode)
oceania <- banco_mundial_1 %>% filter(`Country Code` %in% oceania$countrycode)

esp_africa <- africa %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp_africa <- janitor::clean_names(esp_africa)
esp_africa <- cbind(esp_africa, date)
esperanza_media_africa <- esp_africa %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_africa = mean(esperanza_de_vida_al_nacer_total_anos))
esp_asia <- asia %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp_asia <- janitor::clean_names(esp_asia)
esp_asia <- cbind(esp_asia, date)
esperanza_media_asia <- esp_asia %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_asia = mean(esperanza_de_vida_al_nacer_total_anos))
esp_europa <- europa %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp_europa <- janitor::clean_names(esp_europa)
esp_europa <- cbind(esp_europa, date)
esperanza_media_europa <- esp_europa %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_europa = mean(esperanza_de_vida_al_nacer_total_anos))
esp_america <- america %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp_america <- janitor::clean_names(esp_america)
esp_america <- cbind(esp_america, date)
esperanza_media_america <- esp_america %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_america = mean(esperanza_de_vida_al_nacer_total_anos))
esp_oceania <-oceania %>% select(year, 'Country Name', 'Esperanza de vida al nacer, total (años)')
esp_oceania <- janitor::clean_names(esp_oceania)
esp_oceania <- cbind(esp_oceania, date)
esperanza_media_oceania <- esp_oceania %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_oceania = mean(esperanza_de_vida_al_nacer_total_anos))

g6 <- ggplot() +
  geom_line(data = esp_1, aes(date, esperanza_de_vida_al_nacer_total_anos), color="#2d7d3e", size=1.2 ) +
  geom_line(data = esperanza_media_africa, aes(date, esperanza_de_vida_media_africa), color="grey", size=0.5 ) +
  geom_line(data = esperanza_media_america, aes(date, esperanza_de_vida_media_america), color="grey", size=0.5 ) +
  geom_line(data = esperanza_media_asia, aes(date, esperanza_de_vida_media_asia), color="grey", size=0.5 ) +
  geom_line(data = esperanza_media_europa, aes(date, esperanza_de_vida_media_europa), color="grey", size=0.5 ) +
  geom_line(data = esperanza_media_oceania, aes(date, esperanza_de_vida_media_oceania), color="grey", size=0.5 ) +
  theme_ipsum() +
  labs(title = "Esperanza de vida media por continentes", 
       subtitle =  "Elaboración propia con datos del Banco Mundial") + 
  ylab("PIB per cápita") + xlab("Año") +
  scale_y_continuous(breaks = seq(35, 85, 5), limits = c(40, 80)) +
  scale_x_continuous(breaks = seq(1950, 2020, 5)) +
  annotate(geom = "text", x= 1999, y = 62, label = "Sudáfrica", size = 3, color = "#2d7d3e") +
  annotate(geom = "text", x= 2020, y = 80,label = "Europa",size = 3,  color = "black") + 
  annotate(geom = "text", x= 2020, y = 74.5,label = "Asia",size = 3,  color = "black") + 
  annotate(geom = "text", x= 2019, y = 77,label = "América",size = 3,  color = "black") + 
  annotate(geom = "text", x= 2007, y = 69,label = "Oceanía",size = 3,  color = "black") + 
  annotate(geom = "text", x= 2020, y = 62.5,label = "África",size = 3,  color = "black") 
g6 

```



<br>


## <FONT COLOR="#12522f"> 5.2 Comparación con los BRICS + España </FONT>

<FONT COLOR="#8f2b30">
De nuevo apreciamos el mismo problema, la tendencia hasta los 90 era similar al resto, aunque siendo de los peores, pero a partir de los 90 el bajón deja al país en una muy mala situación. En ningún momento superó a la media global.
</FONT>
```{r, eval = TRUE, echo = TRUE}
esperanza_media <- esp %>% 
  group_by(date) %>% drop_na() %>% summarise(esperanza_de_vida_media_mundo = mean(esperanza_de_vida_al_nacer_total_anos))


esp_2 <- esp %>% mutate(paises = country_name) %>% filter(country_name %in% c("Brasil", "Federación de Rusia", "India", "China", "España")) 


g7 <- ggplot(esp_1, aes(x=date, y=esperanza_de_vida_al_nacer_total_anos )) +
  geom_line(data=esp_2 %>% dplyr::select(-country_name), aes(group=paises), color="grey", size=0.5, alpha=1) +
  geom_line( aes(group=country_name), color="#2d7d3e", size=1.2 ) +
  scale_color_viridis(discrete = TRUE) +
  theme_ipsum() +
  theme(
    legend.position = "left",
    plot.title = element_text(size=14),
    panel.grid = element_blank()) +
  labs(title = "Esperanza de vida en los BRICS + España", caption = "Elaboración propia con datos del Banco Mundial") + 
  ylab(NULL) + xlab(NULL) +
  scale_y_continuous(breaks = seq(10, 90, 5), limits = c(40,85)) + 
  scale_x_continuous( breaks = seq(1960, 2020, 5))+ 
  theme(axis.text.x = element_text(angle=45)) +
  annotate(geom = "text", x= 2018, y = 66,label = "Sudáfrica",size = 3,  color = "black") + annotate(geom = "text", x= 2018, y = 71,label = "India",size = 3,  color = "black") + annotate(geom = "text", x= 2018, y = 85,label = "España",size = 3,  color = "black") + annotate(geom = "text", x= 2018, y = 79,label = "China",size = 3,  color = "black") + annotate(geom = "text", x= 2018, y = 76,label = "Brasil",size = 3,  color = "black") + annotate(geom = "text", x= 2018, y = 74,label = "Rusia",size = 3,  color = "black")

g7 + geom_line(data = esperanza_media, aes(date, esperanza_de_vida_media_mundo), color = "#a62d2d") +
  annotate(geom = "text", x= 2003, y = 69,label = "Media mundo",size = 3,  color = "#a62d2d")

```



<br>



# <FONT COLOR="#2b308f"> **6. Sectores de crecimiento** </FONT> {.tabset .tabset-pills}




<FONT COLOR="#8f2b30">
La evolución en este sentido ha sido más que correcta. Normalmente, en los países desarrollados, el Valor Añadido Bruto se compone por una gran cantidad de servicios, mientras que la industria y, sobre todo la agricultura comienza a perder peso. Los servicios son el sector dominante en la actualidad en lo que a VAB se refiere, una economía con un peso demasiado alto de cualquiera de los otros 2 sectores es muy poco probable que sea una economía desarrollada. Sudáfrica, en este sentido, está a la altura de países desarrollados.
</FONT>


## <FONT COLOR="#12522f"> 1960</FONT>


```{r, eval = TRUE, echo = TRUE}
df_sector <- banco_mundial_1 %>% select(year, `Country Name`, `Agricultura, valor agregado (% del PIB)`, `Industria, valor agregado (% del PIB)`) 
df_sector <- janitor::clean_names(df_sector)
df_sector <- df_sector %>% filter(country_name == 'Sudáfrica') %>% 
  mutate(servicios = 100 - (agricultura_valor_agregado_percent_del_pib + industria_valor_agregado_percent_del_pib))
df_sector <- cbind(df_sector, date)
df_sector1 <- df_sector %>%
  filter(date %in% c(1960, 1995, 2020)) %>% select(-c(year, country_name))
s1960 <- df_sector1 %>% filter(date == 1960) %>% select(-date)  
s1960 <- s1960 %>% pivot_longer(cols = 1:3 ,values_to = "s1960", names_to = "sectores" ) %>% 
  select(s1960)
s1995 <- df_sector1 %>% filter(date == 1995) %>% select(-date)  
s1995 <- s1995 %>% pivot_longer(cols = 1:3 ,values_to = "s1995", names_to = "sectores" ) %>% 
  select(s1995)
s2020 <- df_sector1 %>% filter(date == 2020) %>% select(-date) %>% pivot_longer(cols = 1:3 ,values_to = "s2020", names_to = "sectores" ) %>% 
  select(s2020)


etiqueta60 <- paste0(round(s1960$s1960, 2), "%")
pie(s1960$s1960, labels = etiqueta60)
legend("topleft", legend = c("Agricultura", "Industria", "Servicios"),
       fill =  c("white", "lightblue", "mistyrose"))
title("Peso de los sectores en el VAB en 1960")
```



## <FONT COLOR="#12522f"> 1995</FONT>


```{r, eval = TRUE, echo = TRUE}
etiqueta95 <- paste0(round(s1995$s1995, 2), "%")
pie(s1995$s1995, labels = etiqueta95)
legend("topleft", legend = c("Agricultura", "Industria", "Servicios"),
       fill =  c("white", "lightblue", "mistyrose"))
title("Peso de los sectores en el VAB en 1995")

```



## <FONT COLOR="#12522f"> 2020 </FONT>



```{r, eval = TRUE, echo = TRUE}
etiqueta20 <- paste0(round(s2020$s2020, 2), "%")
pie(s2020$s2020, labels = etiqueta20)
legend("topleft", legend = c("Agricultura", "Industria", "Servicios"),
       fill =  c("white", "lightblue", "mistyrose"))
title("Peso de los sectores en el VAB en 2020")
```



<br>


# <FONT COLOR="#2b308f"> **7. Comercio** </FONT>


## <FONT COLOR="#12522f"> 7.1 Tasa de apertura </FONT>


<FONT COLOR="#8f2b30">
La tasa de apertura se define como las exportaciones más las importaciones dividido entre el PIB de un país. No podemos decir que esta sea una gran cifra para Sudáfrica, que ya vemos que no supera en prácticamente ningún año a los países de su entorno. Aún así, tampoco son malos datos, ya que, más o menos, se ha mantenido rondano el 50% del PIB.
</FONT>

```{r, eval = TRUE, echo = TRUE}
df_comercio <- banco_mundial_1 %>% select(year, `Country Name`, `Exportaciones de bienes y servicios (% del PIB)`, `Importaciones de bienes y servicios (% del PIB)`) %>% 
  filter(`Country Name` == 'Sudáfrica')
df_comercio <- df_comercio %>% mutate(tasa_apertura = `Exportaciones de bienes y servicios (% del PIB)`+ `Importaciones de bienes y servicios (% del PIB)`) %>%
  mutate(tasa_cobertura = `Exportaciones de bienes y servicios (% del PIB)`/`Importaciones de bienes y servicios (% del PIB)`)

df_comercio<-cbind(df_comercio, date)


df_comercio <- df_comercio%>% select(-year)

df_comercio2 <- banco_mundial_1 %>% select(year, `Country Name`, `Exportaciones de bienes y servicios (% del PIB)`, `Importaciones de bienes y servicios (% del PIB)`)          
df_comercio2 <- janitor::clean_names(df_comercio2)
df_comercio2<-cbind(df_comercio2, date)
df_comercio2 <- df_comercio2%>% select(-year)
df_comercio3 <- df_comercio2 %>%
  filter(country_name %in% c("Angola", "Sudáfrica", "Burundi", "Cabo Verde", "República Centroafricana", "República Democrática del Congo", "República del Congo", "Côte d'Ivoire", "Eritrea", "Etiopía", "Guinea", "Kenya", "Lesotho", "Liberia", "Madagascar", "Mauritania", "Mozambique", "Sierra Leona", "Somalia", "Sudán", "Botswana", "Tanzania", "Uganda", "Zimbabwe"))
df_comercio3 <- df_comercio3 %>% mutate(tasa_apertura = exportaciones_de_bienes_y_servicios_percent_del_pib + importaciones_de_bienes_y_servicios_percent_del_pib) %>%
  mutate(tasa_cobertura = (exportaciones_de_bienes_y_servicios_percent_del_pib/importaciones_de_bienes_y_servicios_percent_del_pib)*100) %>%
  group_by(date) %>% drop_na(tasa_apertura) %>% 
  mutate(media = mean(tasa_apertura))
df_comercio4 <- df_comercio3 %>% filter(country_name == 'Sudáfrica')
comercio2 <-   ggplot(df_comercio4, aes(x=date, y=tasa_apertura)) +
  geom_line(data = df_comercio4, aes(date, tasa_apertura), color="grey") +
  geom_point(shape=21, color="black", fill="#69b3a2", size=1) +
  theme_ipsum() +
  labs(title = "Tasa de apertura (en %)", caption = "Elaboración propia con datos del Banco Mundial")  + ylab(NULL) + xlab("Año") +
  scale_y_continuous(breaks = seq(20, 100, 10), limits = c(20, 100)) + 
  scale_x_continuous(breaks = seq(1960,2020, 20))
comercio2 + geom_line(data = df_comercio3, aes(date, media), color="grey") +
  geom_point(data = df_comercio3, aes(date, media),  shape=21, color="green", fill="#69b3a2", size=1) +  annotate(geom = "text", x= 2020, y = 48,label = "Sudáfrica",size = 3,  color = "darkgrey") + annotate(geom = "text", x= 2016, y = 78,label = "África subsahariana",size = 3,  color = "green")
```


## <FONT COLOR="#12522f"> 7.2 Tasa de cobertura </FONT>


<FONT COLOR="#8f2b30">
Lo bueno de lo anterior es que, la mayor parte del comercio exterior, aunque no sea super abundante, son exportaciones. Así se aprecia en la tasa de cobertura (exportaciones/importaciones), donde casi siempre se ha encontrado por encima del 100%. Esto indica que Sudáfrica es un país exportador, lo cual es positivo para la balanza de capitales. 

Aún así, lo cierto es que tampoco apreciamos ninguna evolución en ninguna de las dos tasas a lo largo de los años.
</FONT>
```{r, eval = TRUE, echo = TRUE}
df_comercio3 <- df_comercio3 %>% select(-media) %>%
  mutate(media = mean(tasa_cobertura))
df_comercio4 <- df_comercio3 %>% filter(country_name == 'Sudáfrica')
comercio3 <-   ggplot(df_comercio4, aes(x=date, y=tasa_cobertura)) +
  geom_line(data = df_comercio4, aes(date, tasa_cobertura), color="grey") +
  geom_point(shape=21, color="black", fill="#69b3a2", size=1) +
  theme_ipsum() +
  labs(title = "Tasa de cobertura (en %)", caption = "Elaboración propia con datos del Banco Mundial")  + ylab(NULL) + xlab("Año") +
  scale_y_continuous(breaks = seq(50, 150, 10), limits = c(50, 150)) + 
  scale_x_continuous(breaks = seq(1960,2020, 20))
comercio3 + geom_line(data = df_comercio3, aes(date, media), color="grey") +
  geom_point(data = df_comercio3, aes(date, media),  shape=21, color="green", fill="#69b3a2", size=1) +  annotate(geom = "text", x= 2020, y = 124,label = "Sudáfrica",size = 3,  color = "darkgrey") + annotate(geom = "text", x= 2016, y = 80,label = "África subsahariana",size = 3,  color = "green")
```



## <FONT COLOR="#12522f"> 7.3 Inversión extranjera directa </FONT>{.tabset .tabset-pills}



<FONT COLOR="#8f2b30">
Como podemos observar, la IED de Sudáfrica ha crecido considerablemente en el tiempo aunque de manera más que irregular. Sí que podemos hablar de que Sudáfrica ha participado en la gloalización y se ha aprovechado de ella.
</FONT>



### <FONT COLOR="#8f2b30"> **En Sudáfrica** </FONT>

```{r, eval = TRUE, echo = TRUE}
ied <- banco_mundial_1 %>% select(year, 'Country Name', `Inversión extranjera directa, entrada neta de capital (balanza de pagos, US$ a precios actuales)`, 'Country Code')
ied <- janitor::clean_names(ied)
ied<-cbind(ied, date)
ied <- ied%>% select(-year)
ied <- ied %>% rename(IED = inversion_extranjera_directa_entrada_neta_de_capital_balanza_de_pagos_us_a_precios_actuales)
ied <- ied %>% mutate(IED = IED/1000000)
ied <- ied%>% drop_na()
iedsud <- ied %>% filter(country_name == "Sudáfrica")
gied <-   ggplot(iedsud, aes(x=date, y=IED)) +
  geom_line(data = iedsud, aes(date, IED), color="grey") +
  geom_point(shape=21, color="black", fill="#69b3a2", size=1) +
  theme_ipsum() +
  labs(title = "Inversión extranjera directa, entrada neta de capital ", subtitle = "Balanza de pagos, millones de US$ a precios actuales", caption = "Elaboración propia con datos del Banco Mundial")  + ylab(NULL) + xlab("Año") +
  scale_y_continuous(NULL, labels = scales::dollar) 
gied

```



### <FONT COLOR="#8f2b30"> **En el mundo** </FONT>

```{r, eval = TRUE, echo = TRUE}
continents <- World %>% rename(country_code = iso_a3) %>% select(country_code, continent)
ied_cont <- inner_join(ied, continents)
ied_cont2 <- ied_cont %>% group_by(continent, date) %>% summarise(total_IED = sum(IED)) %>% 
  ungroup()%>%
  group_by(date) %>%
  mutate(world_IED = sum(total_IED)) %>%
  ungroup() %>%
  group_by(date) %>%
  mutate(porcentaje_IED = (total_IED/world_IED)*100) %>% 
  filter(date %in% c(1970,1980,1990,2000,2010,2019))


g8 <- ggplot(ied_cont2, aes(x=date, y=world_IED)) +
  geom_bar(aes(fill= continent, label = porcentaje_IED) , stat="identity") +
  theme_classic()  +
  labs(title = "Inversión extranjera directa, entrada neta de capital ", 
       fill = "% de población")  + ylab(NULL) + xlab("Año")+
  scale_y_continuous(NULL, labels = scales::dollar) 
ggplotly(g8)
```



<br>



# <FONT COLOR="#2b308f"> **8. Pobreza y tecnología** </FONT>


## <FONT COLOR="#12522f"> 8.1 Pobreza </FONT> {.tabset .tabset-pills}



<FONT COLOR="#8f2b30">
En estos 2 mapas se aprecia como Sudáfrica cuenta con uno de los porcentajes de población pobre más altos del mundo, aunque de los más bajos de África. Aquí podemos ver la media del porcentaje de población entre los años 60 y 95, y después entre los años 95 y 2020. 
</FONT>


### <FONT COLOR="#8f2b30"> **Pre-1995** </FONT>
```{r, eval = TRUE, echo = TRUE}
data(World) 
world <- World %>%
  rename(countrycode = iso_a3) %>%
  select(countrycode, continent)
world2 <- world  %>% rename(country_code = countrycode )
banco_mundial_1 <- banco_mundial_1 %>%
  rename(country_code = `Country Code`)
df_pobreza <-banco_mundial_1 %>% select(country_code, `Country Name`, year, `Tasa de incidencia de la pobreza, sobre la base de $1,90 por día (2011 PPA) (% de la población)`)
world3 <- world2 %>% select(country_code)
df_pobreza2 <- inner_join(world3, df_pobreza)
df_pobreza2<-cbind(df_pobreza2, date)
df_pobreza3 <- df_pobreza2 %>% filter(date <= 1995) %>% drop_na(Tasa.de.incidencia.de.la.pobreza..sobre.la.base.de..1.90.por.día..2011.PPA.....de.la.población.)
df_pobreza3 <- df_pobreza3 %>% group_by(Country.Name) %>% summarise(media = mean(Tasa.de.incidencia.de.la.pobreza..sobre.la.base.de..1.90.por.día..2011.PPA.....de.la.población.))


mapa2 <- ggplot() +
  geom_sf(data = df_pobreza3, aes(geometry = geometry, fill = media)) +
  theme_void()  +
  theme(plot.subtitle = element_text(family = "serif", face = "italic"),
        plot.title = element_text(family = "serif", face =  "italic")) +
  labs(title = "Tasa de incidencia de la pobreza sobre la base de 1.90$ por día (2011 PPA)", 
       subtitle = "Media entre 1960 - 1995 " , 
       caption = "Fuente: Elaboración propia con datos del Madison Project Database",
       fill = "% de población")  +
  scale_fill_continuous(low="#fffcbf",high="#3e9851") + 
  theme(plot.title = element_text(hjust = 20), plot.subtitle = element_text(hjust = 0.3), 
        plot.caption = element_text(hjust = 1.5))

mapa2 
```

### <FONT COLOR="#8f2b30"> **Post-1995** </FONT>

```{r, eval = TRUE, echo = TRUE}
df_pobreza4 <- df_pobreza2 %>% filter(date >= 1995) %>% drop_na(Tasa.de.incidencia.de.la.pobreza..sobre.la.base.de..1.90.por.día..2011.PPA.....de.la.población.)
df_pobreza4 <- df_pobreza4 %>% group_by(Country.Name) %>% summarise(media = mean(Tasa.de.incidencia.de.la.pobreza..sobre.la.base.de..1.90.por.día..2011.PPA.....de.la.población.))
mapa3 <- ggplot() +
  geom_sf(data = df_pobreza4, aes(geometry = geometry, fill = media)) +
  theme_void()  +
  theme(plot.subtitle = element_text(family = "serif", face = "italic"),
        plot.title = element_text(family = "serif", face =  "italic")) +
  labs(title = "Tasa de incidencia de la pobreza sobre la base de 1.90$ por día (2011 PPA)", 
       subtitle = "Media entre 1995 - 2020 " , 
       caption = "Fuente: Elaboración propia con datos del Madison Project Database",
       fill = "% de población")  +
  scale_fill_continuous(low="#fffcbf",high="#3e9851") + 
  theme(plot.title = element_text(hjust = 20), plot.subtitle = element_text(hjust = 0.3), 
        plot.caption = element_text(hjust = 1.5))

mapa3 
```


<br>


## <FONT COLOR="#12522f"> 8.2 Tecnología </FONT>
<FONT COLOR="#8f2b30">
Para ilustrar el acceso a la tecnología tenemos un gráfico con el crecimiento en el uso de teléfonos móviles año a año. Podemos apreciar como, en los 90, el crecimiento en Sudáfrica fue enorme, aunque este lleg´con retraso con respecto a los continentes más desarrollados. Aún así, casi siempre está por encima de la media del continente africano. 
</FONT>
```{r, eval = TRUE, echo = TRUE}
dfmobil <- banco_mundial_1 %>% select(year, `Suscripciones a telefonía celular móvil (por cada 100 personas)`, `Country Name`, country_code) %>% rename(moviles = `Suscripciones a telefonía celular móvil (por cada 100 personas)`)

dfmobil<- janitor::clean_names(dfmobil) 

dfmobil <- cbind(date, dfmobil) 

dfmobil <- dfmobil %>% select(-year) %>% filter(date >= 1975) %>%
  arrange(date)
dfmobil[is.na(dfmobil)] <- 0
dfmobil <- dfmobil %>%  group_by(country_name) %>%
  mutate(crecimiento_anual = ((moviles - lag(moviles))/lag(moviles))*100)
dfmobil[is.na(dfmobil)] <- 0
#tenemos problemas cuando pasa de 0 a un número, ya que al dividir entre 0 da infinito, lo que queremos es que en lugar de infinito ponga 100 ya que crece un 100 %. 
dfmobil <- dfmobil %>% mutate(crecimiento = case_when(
  crecimiento_anual > 1000 ~ 100, 
  crecimiento_anual < 1000  ~ crecimiento_anual
)) %>% select(-crecimiento_anual)
africa_mobiles <- dfmobil %>%  filter(country_code %in% africa$`Country Code`)

africa_mobiles <- africa_mobiles %>% group_by(date)%>%
  summarise(media_africa = mean(crecimiento))
asia_mobiles <- dfmobil %>%  filter(country_code %in% asia$`Country Code`) %>% 
  group_by(date) %>%
  summarise(media_asia = mean(crecimiento))
america_mobiles <- dfmobil %>%  filter(country_code %in% america$`Country Code`)%>% 
  group_by(date) %>%
  summarise(media_america = mean(crecimiento))
europa_mobiles <- dfmobil %>%  filter(country_code %in% europa$`Country Code`) %>% 
  group_by(date) %>%
  summarise(media_europa = mean(crecimiento))
oceania_mobiles <- dfmobil %>%  filter(country_code %in% oceania$`Country Code`) %>% 
  group_by(date) %>%
  summarise(media_oceania = mean(crecimiento))
sudafrica_mobiles <- dfmobil %>% filter(country_code == "ZAF") %>%
  select(date, crecimiento)
df12 <- inner_join(oceania_mobiles, europa_mobiles)
df13 <- inner_join(africa_mobiles, asia_mobiles)
df14 <- inner_join(df12, df13)
df15 <- inner_join(df14, america_mobiles)
df16 <- inner_join(df15, sudafrica_mobiles) %>% select(-country_name) %>% 
  pivot_longer(cols = (2:7) ,values_to = "crecimiento_anual", names_to = "region")


g9 <- ggplot(df16, aes(x= date, y= crecimiento_anual)) + 
  labs(title = "Evolución uso de redes móbiles en el mundo",
       x= "Año",
       y= "Crecimiento anual",
       color = "Regiones") +
  geom_point(aes(color= region), size= 3) +
  geom_line(aes(color= region), size= 1.5) + 
  scale_color_manual(values= c("red", "blue", "green", "black",
                               "yellow", "orange", "midnightblue"),
                     labels = c("Sudáfrica",
                                "África",
                                "América",
                                "Asia",
                                "Europa",
                                "Oceanía"
                                ))+
  theme_minimal() +
  theme(plot.title = element_text(size = 20, face = "bold",
                                  hjust = 0.5),
        axis.title.x = element_text(size = 13, hjust = 1,
                                    vjust = 0),
        axis.title.y = element_text(size = 13, hjust = 1, vjust = 1),
        legend.title = element_text(face = "bold")) +
  transition_reveal(date) + 
  view_follow()
g9
```



<br><br>

<hr class="linea-red">
<hr class="linea-red">


```{r, echo = FALSE}
sessioninfo::session_info() %>% details::details(summary = 'Información de mi R-sesión:') 
```


<br><br>

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
<br><br>

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
